class stsCalendar{constructor(e,t=[],s={previousDateSelection:!1,multipleSelection:!1,RandomSelection:!1,WeekStartFrom:"Sun",monthsToShow:1}){if(this.element=document.getElementById(e),!this.element)throw Error(`Element with id "${e}" not found`);this.currentDate=new Date,this.bookedDates=t,this.selectedDates=new Set,this.previousDateSelection=s.previousDateSelection||!1,this.multipleSelection=s.multipleSelection||!1,this.RandomSelection=s.RandomSelection||!1,this.WeekStartFrom=s.WeekStartFrom||"Sun",this.monthsToShow=s.monthsToShow||1,this.startDate=null,this.endDate=null,this.tempEndDate=null,this.createMessageContainer(),this.render()}createMessageContainer(){this.msg_container=document.createElement("div"),this.msg_container.className="msg-container",this.msg_container.style.display="none",this.CalDispMsg=document.createElement("span"),this.CalDispMsg.className="Cal-Disp-Msg",this.msg_container.appendChild(this.CalDispMsg),this.element.appendChild(this.msg_container)}render(){this.element.innerHTML="",this.element.appendChild(this.msg_container);let e=document.createElement("div");e.className="calendar-months-container";let t=this.getDaysOfWeek(),s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(let a=0;a<this.monthsToShow;a++){let i=new Date(this.currentDate);i.setMonth(i.getMonth()+a);let n=document.createElement("div");n.className="calendar-wrapper";let l=document.createElement("div");l.className="calendar-header";let d=document.createElement("span");if(d.textContent=i.toLocaleDateString("en-US",{month:"long",year:"numeric"}),0===a){let h=document.createElement("button");h.textContent="<",h.addEventListener("click",()=>this.changeMonth(-1)),l.appendChild(h)}if(l.appendChild(d),a===this.monthsToShow-1){let r=document.createElement("button");r.textContent=">",r.addEventListener("click",()=>this.changeMonth(1)),l.appendChild(r)}n.appendChild(l);let o=document.createElement("div");o.className="calendar-body";let c=document.createElement("div");c.className="week-header",t.forEach(e=>{let t=document.createElement("div");t.className="week-day",t.textContent=e,c.appendChild(t)}),o.appendChild(c);let D=new Date(i.getFullYear(),i.getMonth(),1),m=D.getDay(),p=t.indexOf(s[m]);for(let u=0;u<p;u++){let g=document.createElement("div");g.className="empty-day",o.appendChild(g)}let S=new Date(i.getFullYear(),i.getMonth()+1,0).getDate();for(let f=1;f<=S;f++){let C=document.createElement("div");C.className="day",C.textContent=f;let E=i.getFullYear(),w=String(i.getMonth()+1).padStart(2,"0"),v=String(f).padStart(2,"0"),k=`${E}-${w}-${v}`;C.setAttribute("data-date",k);let _=new Date().toLocaleDateString("en-CA"),y=this.previousDateSelection&&k<_,M=this.bookedDates.includes(k),L=k===_;if(y&&C.classList.add("disabled"),M&&C.classList.add("booked"),L&&C.classList.add("date_today"),this.selectedDates.has(k)&&C.classList.add("date_selected"),this.multipleSelection&&this.startDate&&this.endDate){let b=new Date(k);b>=this.startDate&&b<=this.endDate&&C.classList.add("date_selected")}y||M||(C.addEventListener("click",()=>this.handleDateClick(C,k)),C.addEventListener("mouseover",()=>this.handleDateHover(k))),o.appendChild(C)}n.appendChild(o),e.appendChild(n)}this.element.appendChild(e)}getDaysOfWeek(){let e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],t=e.indexOf(this.WeekStartFrom);return -1===t?e.slice():[...e.slice(t),...e.slice(0,t)]}handleDateHover=e=>{this.startDate&&!this.endDate&&(this.tempEndDate=new Date(e),this.applyHoverEffect())};applyHoverEffect(){let e=Array.from(this.element.querySelectorAll(".day"));if(e.forEach(e=>e.classList.remove("hiddenselect")),this.startDate&&this.tempEndDate){let t=new Date(this.startDate),s=new Date(this.tempEndDate),a=t<s?s:t;for(let i=new Date(t<s?t:s);i<=a;i.setDate(i.getDate()+1)){let n=this.formatDate(i),l=e.find(e=>e.getAttribute("data-date")===n);l&&l.classList.add("hiddenselect")}}}changeMonth(e){this.currentDate.setDate(1),this.currentDate.setMonth(this.currentDate.getMonth()+e),this.render()}handleDateClick(e,t){let s=new Date(t);if(this.bookedDates.includes(t)){this.resetWithError("Selected date is locked.");return}if(this.multipleSelection&&!this.RandomSelection){if(!this.startDate||this.startDate&&this.endDate)this.reset(),this.startDate=s;else{this.endDate=s;let a=this.startDate<this.endDate?this.startDate:this.endDate,i=this.startDate>this.endDate?this.startDate:this.endDate;if(this.isLockedDateInRange(a,i)){this.resetWithError("Has booked dates in range.");return}this.startDate=a,this.endDate=i,this.updateSelectedRange()}}else this.multipleSelection&&this.RandomSelection?this.selectedDates.has(t)?(this.selectedDates.delete(t),e.classList.remove("date_selected")):(this.selectedDates.add(t),e.classList.add("date_selected")):(this.selectedDates.clear(),this.selectedDates.add(t),this.render())}isLockedDateInRange(e,t){for(let s=new Date(e);s<=t;s.setDate(s.getDate()+1))if(this.bookedDates.includes(this.formatDate(s)))return!0;return!1}resetWithError(e){this.reset(),this.CalDispMsg.textContent=e,this.msg_container.style.display="block",this.msg_container.classList.add("show"),setTimeout(()=>{this.msg_container.style.display="none",this.msg_container.classList.remove("show")},3e3)}updateSelectedRange(){if(!this.startDate||!this.endDate)return;this.selectedDates.clear();let e=new Date(this.startDate),t=new Date(this.endDate);for(let s=new Date(e);s<=t;s.setDate(s.getDate()+1)){let a=this.formatDate(s);this.selectedDates.add(a)}this.render()}reset(){this.selectedDates.clear(),this.startDate=null,this.endDate=null,this.tempEndDate=null,this.render()}formatDate(e){let t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${a}`}getSelectedDates(){let e=Array.from(this.selectedDates).sort();return e}}
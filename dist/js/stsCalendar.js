/**
 * Â© 2025 SoftAndTech. All rights reserved.
 * Licensed under the SoftAndTech Proprietary License.
 * See LICENSE file for details.
 */

class stsCalendar{constructor(e,t=[],s={previousDateSelection:!1,multipleSelection:!1,RandomSelection:!1,WeekStartFrom:"Sun",monthsToShow:1,errmessage:null}){if(this.element=document.getElementById(e),!this.element)throw new Error(`Element with id "${e}" not found`);this.currentDate=new Date,this.bookedDates=t,this.selectedDates=new Set,this.previousDateSelection=s.previousDateSelection||!1,this.multipleSelection=s.multipleSelection||!1,this.RandomSelection=s.RandomSelection||!1,this.WeekStartFrom=s.WeekStartFrom||"Sun",this.monthsToShow=s.monthsToShow||1,this.startDate=null,this.endDate=null,this.tempEndDate=null,this.errmessage=s.errmessage||"Selected Dates are locked",this.createMessageContainer(),this.render()}createMessageContainer(){this.msg_container=document.createElement("div"),this.msg_container.className="msg-container",this.msg_container.style.display="none",this.CalDispMsg=document.createElement("span"),this.CalDispMsg.className="Cal-Disp-Msg",this.msg_container.appendChild(this.CalDispMsg),this.element.appendChild(this.msg_container)}render(){this.element.innerHTML="",this.element.appendChild(this.msg_container);const e=document.createElement("div");e.className="calendar-months-container";const t=this.getDaysOfWeek(),s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(let a=0;a<this.monthsToShow;a++){const n=new Date(this.currentDate);n.setMonth(n.getMonth()+a);const i=document.createElement("div");i.className="calendar-wrapper";const d=document.createElement("div");d.className="calendar-header";const r=document.createElement("span");if(r.textContent=n.toLocaleDateString("en-US",{month:"long",year:"numeric"}),0===a){const e=document.createElement("button");e.textContent="<",e.addEventListener("click",(()=>this.changeMonth(-1))),d.appendChild(e)}if(d.appendChild(r),a===this.monthsToShow-1){const e=document.createElement("button");e.textContent=">",e.addEventListener("click",(()=>this.changeMonth(1))),d.appendChild(e)}i.appendChild(d);const l=document.createElement("div");l.className="calendar-body";const o=document.createElement("div");o.className="week-header",t.forEach((e=>{const t=document.createElement("div");t.className="week-day",t.textContent=e,o.appendChild(t)})),l.appendChild(o);const h=document.createElement("div");h.className="days-grid";const c=new Date(n.getFullYear(),n.getMonth(),1).getDay(),D=t.indexOf(s[c]);for(let e=0;e<D;e++){const e=document.createElement("div");e.className="empty-day",h.appendChild(e)}const m=new Date(n.getFullYear(),n.getMonth()+1,0).getDate();for(let e=1;e<=m;e++){const t=document.createElement("div");t.className="day",t.textContent=e;const s=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(e).padStart(2,"0")}`;t.setAttribute("data-date",s);const a=(new Date).toLocaleDateString("en-CA"),i=this.previousDateSelection&&s<a,d=this.bookedDates.includes(s),r=s===a;if(i&&t.classList.add("disabled"),d&&t.classList.add("booked"),r&&t.classList.add("date_today"),this.selectedDates.has(s)&&t.classList.add("date_selected"),this.multipleSelection&&this.startDate&&this.endDate){const e=new Date(s);e>=this.startDate&&e<=this.endDate&&t.classList.add("date_selected")}i||d||(t.addEventListener("click",(()=>this.handleDateClick(t,s))),t.addEventListener("mouseover",(()=>this.handleDateHover(s)))),h.appendChild(t)}l.appendChild(h),i.appendChild(l),e.appendChild(i)}this.element.appendChild(e)}getDaysOfWeek(){const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],t=e.indexOf(this.WeekStartFrom);return-1===t?e.slice():[...e.slice(t),...e.slice(0,t)]}handleDateHover=e=>{this.startDate&&!this.endDate&&(this.tempEndDate=new Date(e),this.applyHoverEffect())};applyHoverEffect(){const e=Array.from(this.element.querySelectorAll(".day"));if(e.forEach((e=>e.classList.remove("hiddenselect"))),this.startDate&&this.tempEndDate){const t=new Date(this.startDate),s=new Date(this.tempEndDate),a=t<s?s:t;for(let n=new Date(t<s?t:s);n<=a;n.setDate(n.getDate()+1)){const t=this.formatDate(n),s=e.find((e=>e.getAttribute("data-date")===t));s&&s.classList.add("hiddenselect")}}}changeMonth(e){this.currentDate.setDate(1),this.currentDate.setMonth(this.currentDate.getMonth()+e),this.render()}handleDateClick(e,t){const s=new Date(t);if(this.bookedDates.includes(t))this.resetWithError("Selected date is locked.");else if(this.multipleSelection&&!this.RandomSelection)if(!this.startDate||this.startDate&&this.endDate)this.reset(),this.startDate=s;else{this.endDate=s;const e=this.startDate<this.endDate?this.startDate:this.endDate,t=this.startDate>this.endDate?this.startDate:this.endDate;if(this.isLockedDateInRange(e,t))return void this.resetWithError(this.errmessage);this.startDate=e,this.endDate=t,this.updateSelectedRange()}else this.multipleSelection&&this.RandomSelection?this.selectedDates.has(t)?(this.selectedDates.delete(t),e.classList.remove("date_selected")):(this.selectedDates.add(t),e.classList.add("date_selected")):(this.selectedDates.clear(),this.selectedDates.add(t),this.render())}isLockedDateInRange(e,t){for(let s=new Date(e);s<=t;s.setDate(s.getDate()+1))if(this.bookedDates.includes(this.formatDate(s)))return!0;return!1}resetWithError(e){this.reset(),this.CalDispMsg.textContent=e,this.msg_container.style.display="block",this.msg_container.classList.add("show"),setTimeout((()=>{this.msg_container.style.display="none",this.msg_container.classList.remove("show")}),3e3)}updateSelectedRange(){if(!this.startDate||!this.endDate)return;this.selectedDates.clear();const e=new Date(this.startDate),t=new Date(this.endDate);for(let s=new Date(e);s<=t;s.setDate(s.getDate()+1)){const e=this.formatDate(s);this.selectedDates.add(e)}this.render()}reset(){this.selectedDates.clear(),this.startDate=null,this.endDate=null,this.tempEndDate=null,this.render()}formatDate(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}getSelectedDates(){return Array.from(this.selectedDates).sort()}}